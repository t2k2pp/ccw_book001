# 第4章: 開発・エンジニアリング（Vibe Coding）

## 4-1. 機能実装指示

このセクションでは、Claude Code、Cursor、Windsurf等のAI駆動開発ツールで効果的な機能実装指示を行うプロンプトを紹介します。

---

## Vibe Codingとは

**Vibe Coding**は、自然言語での指示によってAIが自律的にコーディングを行う開発手法です。
従来の「コードを書く」作業から、「何を作りたいか伝える」作業へのパラダイムシフトです。

### 通常チャットとの違い

| 項目 | 通常チャット | Vibe Coding |
|------|--------------|-------------|
| ツール | Claude.ai, ChatGPT | Claude Code, Cursor, Windsurf |
| 出力 | コードスニペット | ファイル全体・プロジェクト全体 |
| 実行 | 手動でコピー | 自動でファイル作成・編集 |
| コンテキスト | 会話履歴のみ | プロジェクト全体を把握 |
| 指示の粒度 | 細かい実装指示 | 高レベルな機能要求 |

### Vibe Codingの効果的な指示のコツ

1. **プロジェクト構造を先に理解させる**
2. **既存コードとの統合を意識させる**
3. **段階的に機能を追加する**
4. **テストを含めて指示する**
5. **エラーは即座に共有して修正を依頼**

---

### 🆕 新機能の実装依頼

#### 使用手法
- **Constraint Prompting**（既存コードベースの制約）
- **Role Prompting**（プロジェクトの文脈を与える）

#### 期待する効果
- プロジェクト全体と整合性のある実装
- 適切なファイル分割と命名
- 既存のコーディングスタイルの踏襲

#### 推奨ツール
- **推奨**: Claude Code, Cursor, Windsurf, GitHub Copilot Workspace
- **理由**: プロジェクト全体を理解して実装できる

#### 非推奨ケース
- o1等の推論モデルをCLIで使用：Vibe Codingには向かない（通常チャットで設計を詰めてから実装）

#### プロンプト例

```
このプロジェクトに以下の新機能を実装してください。

【機能概要】
[実装したい機能の説明]

【要件】
- [要件1]
- [要件2]
- [要件3]

【制約・前提】
- 既存の[X]機能と統合すること
- [Y]のコーディング規約に従うこと
- [Z]フレームワークを使用すること

【期待するファイル構成】
- [ファイル1]: [役割]
- [ファイル2]: [役割]
（AIに任せる場合は省略可）

【実装の進め方】
1. まず既存のプロジェクト構造を確認
2. 必要なファイルを作成・編集
3. テストコードも一緒に実装
4. 動作確認の方法を教えてください

それでは実装をお願いします。
```

**具体例：React プロジェクトにユーザープロフィール編集機能を追加**

```
このReactプロジェクトにユーザープロフィール編集機能を実装してください。

【機能概要】
ユーザーが自分のプロフィール情報（名前、メールアドレス、自己紹介）を
編集できるフォームと保存機能

【要件】
- フォームバリデーション（必須項目チェック、メール形式チェック）
- 保存中はボタンを無効化しローディング表示
- 保存成功/失敗時のトースト通知
- レスポンシブデザイン

【制約・前提】
- 既存の認証機能（src/contexts/AuthContext.tsx）と連携
- APIは `/api/users/profile` エンドポイント（PUT）を使用
- Tailwind CSSでスタイリング
- React Hook Formを使用

【実装の進め方】
1. まず src/ ディレクトリの構造を確認
2. ProfileEditForm コンポーネントを作成
3. 必要なカスタムフックを作成
4. ルーティングに追加
5. テストコードも実装

それでは実装をお願いします。エラーが出たら教えてください。
```

---

### 🎨 UI コンポーネントの実装

#### 使用手法
- **Few-shot Prompting**（既存コンポーネントのスタイルを踏襲）
- **Constraint Prompting**（デザインシステムの指定）

#### 期待する効果
- デザイン統一性のあるコンポーネント
- 再利用可能な実装
- アクセシビリティ対応

#### プロンプト例

```
以下の仕様に従って、[コンポーネント名]を実装してください。

【コンポーネント仕様】
- 役割: [何をするコンポーネントか]
- Props: [必要なprops]
- 状態: [内部状態]
- イベント: [発火するイベント]

【デザイン要件】
- [既存の X コンポーネント]と同じスタイル基準
- [Y] のカラーパレットを使用
- レスポンシブ対応（モバイル/タブレット/デスクトップ）

【アクセシビリティ】
- ARIA属性の適切な設定
- キーボード操作対応
- スクリーンリーダー対応

【参考にすべき既存コンポーネント】
[既存コンポーネントのパス]

それでは実装をお願いします。Storybookのstoriesファイルも作成してください。
```

**具体例：モーダルダイアログコンポーネント**

```
汎用的なModalコンポーネントを実装してください。

【コンポーネント仕様】
- 役割: 汎用的なモーダルダイアログ
- Props:
  - isOpen: boolean
  - onClose: () => void
  - title: string
  - children: ReactNode
  - size?: 'sm' | 'md' | 'lg' (デフォルト: 'md')
- 状態: なし（完全にpropsで制御）
- イベント: オーバーレイクリック、ESCキーで閉じる

【デザイン要件】
- src/components/Button.tsx と同じスタイル基準
- Tailwind CSSを使用
- オーバーレイは半透明の黒背景
- モーダルはフェードイン/アウトアニメーション
- レスポンシブ（モバイルは画面幅いっぱい、デスクトップは中央配置）

【アクセシビリティ】
- role="dialog", aria-modal="true"
- フォーカストラップ（モーダル内でTabキー移動）
- ESCキーで閉じる
- 開いた時に最初のフォーカス可能要素にフォーカス

【参考にすべき既存コンポーネント】
src/components/Button.tsx
src/components/Card.tsx

【ファイル配置】
src/components/Modal.tsx
src/components/Modal.stories.tsx （Storybook）

それでは実装をお願いします。
```

---

### 🔌 API統合の実装

#### 使用手法
- **Constraint Prompting**（APIスペックの明示）
- **Chain-of-Thought**（エラーハンドリング含む実装フロー）

#### 期待する効果
- 適切なエラーハンドリング
- 型安全なAPI呼び出し
- リトライやタイムアウトの実装

#### プロンプト例

```
以下のAPI統合を実装してください。

【APIエンドポイント】
- エンドポイント: [URL]
- メソッド: [GET/POST/PUT/DELETE]
- 認証: [Bearer token / API Key / etc.]
- リクエスト形式: [JSON]
- レスポンス形式: [JSON]

【API仕様】
リクエスト:
\`\`\`json
{
  "field1": "value",
  "field2": 123
}
\`\`\`

レスポンス（成功時）:
\`\`\`json
{
  "data": { ... },
  "status": "success"
}
\`\`\`

レスポンス（エラー時）:
\`\`\`json
{
  "error": "エラーメッセージ",
  "status": "error"
}
\`\`\`

【実装要件】
- TypeScriptで型定義を作成
- axiosを使用（既存のAPIクライアントがあればそれを使用）
- リトライ機能（最大3回、exponential backoff）
- タイムアウト: 30秒
- エラーハンドリング（ネットワークエラー、HTTPエラー、タイムアウト）
- ローディング状態の管理

【ファイル構成】
- src/api/[resource].ts: API呼び出しロジック
- src/types/[resource].ts: 型定義
- src/hooks/use[Resource].ts: React hook（ReactやVueの場合）

それでは実装をお願いします。使用例も示してください。
```

---

### 🗄️ データベース操作の実装

#### 使用手法
- **Constraint Prompting**（既存のORMやスキーマに合わせる）

#### 期待する効果
- スキーマに整合性のあるDB操作
- 適切なトランザクション処理
- SQLインジェクション対策

#### プロンプト例

```
以下のデータベース操作を実装してください。

【データベース情報】
- DBMS: [PostgreSQL / MySQL / MongoDB / etc.]
- ORM/クライアント: [Prisma / TypeORM / Mongoose / etc.]

【既存スキーマ】
\`\`\`sql
[既存のテーブル定義]
\`\`\`

【実装する操作】
- [操作1]: [説明]
- [操作2]: [説明]

【要件】
- トランザクション処理が必要な箇所は適切に実装
- エラーハンドリング（制約違反、接続エラー等）
- ページネーション対応（一覧取得の場合）
- 適切なインデックスの提案

【ファイル構成】
- src/models/[resource].ts: モデル定義
- src/repositories/[resource]Repository.ts: DB操作ロジック

それでは実装をお願いします。
```

---

### 📝 フォームとバリデーションの実装

#### 使用手法
- **Constraint Prompting**（バリデーションルールの明示）
- **Few-shot Prompting**（既存フォームのパターンを踏襲）

#### 期待する効果
- ユーザーフレンドリーなフォーム
- 適切なバリデーション
- アクセシビリティ対応

#### プロンプト例

```
以下のフォームを実装してください。

【フォーム項目】
| 項目名 | 型 | 必須 | バリデーション |
|--------|-----|------|----------------|
| [項目1] | text | Yes | 最大100文字 |
| [項目2] | email | Yes | メール形式 |
| [項目3] | number | No | 0-100の範囲 |

【動作要件】
- リアルタイムバリデーション（onBlur）
- 送信前の全体バリデーション
- エラーメッセージの表示
- 送信中はボタン無効化・ローディング表示
- 送信成功時の処理: [説明]

【技術スタック】
- React Hook Form + Zod（Reactの場合）
- [フレームワークに応じて指定]

【既存フォームの参考】
[既存フォームのパス]

【アクセシビリティ】
- 各入力欄にlabel要素を関連付け
- エラーメッセージはaria-describedbyで関連付け
- 必須項目はaria-required="true"

それでは実装をお願いします。
```

---

### 🧪 テストを含めた実装依頼

#### 使用手法
- **Constraint Prompting**（テストカバレッジの指定）

#### 期待する効果
- 実装とテストを同時に完成
- 高いテストカバレッジ
- CI/CDでの自動テスト実行

#### プロンプト例

```
以下の機能を、テストコードとセットで実装してください。

【機能】
[実装したい機能]

【テスト要件】
- カバレッジ: 80%以上
- テストフレームワーク: [Jest / Vitest / PyTest / etc.]
- テストすべき観点:
  - 正常系（期待通りの動作）
  - 異常系（エラーハンドリング）
  - エッジケース（境界値等）
  - [その他の観点]

【テストの種類】
- [ ] ユニットテスト
- [ ] 統合テスト
- [ ] E2Eテスト（必要に応じて）

【実装の進め方】
1. TDD（テスト駆動開発）のアプローチで進めてください
2. まずテストを書く
3. 実装してテストをパスさせる
4. リファクタリング

それでは実装をお願いします。
```

**具体例：計算ユーティリティ関数のTDD実装**

```
消費税計算ユーティリティ関数を、TDDアプローチで実装してください。

【機能】
税込価格を計算する関数 `calculateTaxIncludedPrice(price, taxRate)`

【要件】
- price: 税抜価格（number）
- taxRate: 税率（number, 例: 0.1 for 10%）
- 戻り値: 税込価格（number, 小数点以下切り捨て）
- エラーハンドリング:
  - price が負の数 → エラー
  - taxRate が 0-1 の範囲外 → エラー

【テスト要件】
- カバレッジ: 100%
- テストフレームワーク: Jest
- テストすべき観点:
  - 正常系: 100円×10% → 110円
  - 小数点以下切り捨て: 198円×10% → 217円（217.8の切り捨て）
  - 境界値: 0円、負の価格、税率0%、税率100%
  - 異常系: 負の価格、範囲外の税率

【実装の進め方】
1. src/utils/tax.test.ts に全テストケースを先に書く
2. src/utils/tax.ts を実装してテストをパスさせる

それでは実装をお願いします。
```

---

## Vibe Coding の実践Tips

### ✅ 良い指示の例

```
この Reactプロジェクトにダークモード切り替え機能を実装してください。

- Context API でテーマ状態を管理
- ローカルストレージに設定を保存
- 既存の全コンポーネントでダークモードに対応
- トグルボタンをヘッダーに追加
- Tailwind CSSのdarkモードを使用

実装後、動作確認の方法を教えてください。
```

**なぜ良いか**：
- 要件が明確
- 技術スタックを指定
- 実装範囲が明確
- 既存構造への統合を意識

### ❌ 悪い指示の例

```
ダークモードを追加して
```

**なぜ悪いか**：
- 要件が曖昧
- 既存コードとの統合方法が不明
- 実装の詳細が不足

### 段階的な実装の進め方

```
# ステップ1
まず、このプロジェクトの構造を確認して、
ユーザー認証機能がどこにあるか教えてください。

# ステップ2（AIの回答を確認後）
では、その認証機能を使って、ログイン後に
ダッシュボードにリダイレクトする機能を追加してください。

# ステップ3
ダッシュボードに、ユーザー情報を表示するウィジェットを追加してください。
```

### エラーが出た時の対応

```
エラーが発生しました：
[エラーメッセージ全文]

このエラーを修正してください。
必要であればファイル構造の見直しも行ってください。
```

---

## まとめ

Vibe Codingでは、以下のポイントを意識しましょう：

| ポイント | 説明 |
|----------|------|
| **明確な要件** | 何を作りたいかを具体的に |
| **技術スタック指定** | 使用するライブラリやフレームワークを明示 |
| **既存コードとの統合** | プロジェクト全体の整合性を意識 |
| **段階的な実装** | 一度に全部ではなく、ステップバイステップで |
| **テストも一緒に** | 品質を担保するためにテストも同時実装 |
| **エラーは即共有** | エラーが出たらすぐに全文を共有して修正依頼 |

次のセクションでは、リファクタリング指示について解説します。
